<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
    <title>Avatharam – LiveAvatar Viewer</title>
    <style>
      html,body{
        margin:0;padding:0;height:100%;width:100%;
        background:#050505;color:#f5f5f5;
        font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      }
      .wrap{
        display:flex;flex-direction:column;gap:8px;
        width:100%;height:100%;
        align-items:center;justify-content:flex-start;
        padding:8px 6px 10px;
      }
      .title{
        font-size:14px;text-align:center;margin-top:4px;opacity:.9;
      }
      .title span.name{font-weight:600;}
      .stage{
        position:relative;width:100%;max-width:420px;
        aspect-ratio:16/9;
        background:#111;border-radius:18px;overflow:hidden;
        border:1px solid #222;
        display:flex;align-items:stretch;justify-content:center;
      }
      #lkFrame{
        border:0;margin:0;padding:0;
        width:100%;height:100%;
      }
      .status{
        font-size:12px;opacity:.75;text-align:center;margin-top:2px;
      }
      .toolbar{
        display:flex;gap:8px;margin-top:4px;justify-content:center;
      }
      .btn{
        border-radius:999px;
        padding:4px 12px;
        font-size:12px;
        border:1px solid #444;
        background:#181818;
        color:#f5f5f5;
        cursor:pointer;
      }
      .btn:hover{background:#262626;}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="title">
        <span class="name" id="aname">LiveAvatar</span>
        <span> · Live session</span>
      </div>
      <div class="stage">
        <iframe
          id="lkFrame"
          allow="camera; microphone; autoplay; clipboard-read; clipboard-write"
          allowfullscreen
        ></iframe>
      </div>
      <div class="status" id="status">Preparing LiveAvatar session…</div>
      <div class="toolbar">
        <button class="btn" id="refreshBtn">Reconnect</button>
      </div>
    </div>

    <script>
      // These placeholders are replaced by Streamlit before rendering.
      const AVATAR_NAME   = "__AVATAR_NAME__";
      const LIVEKIT_URL   = "__LIVEKIT_URL__";
      const LIVEKIT_TOKEN = "__LIVEKIT_TOKEN__";
      const WS_URL        = "__WS_URL__"; // reserved for advanced command-events if you add them later

      const nameEl    = document.getElementById("aname");
      const statusEl  = document.getElementById("status");
      const frameEl   = document.getElementById("lkFrame");
      const refreshEl = document.getElementById("refreshBtn");

      nameEl.textContent = AVATAR_NAME || "LiveAvatar";

      function connect() {
        if (!LIVEKIT_URL || !LIVEKIT_TOKEN) {
          statusEl.textContent = "Missing LiveKit URL or token – start a session from the Streamlit app.";
          return;
        }
        const src =
          "https://meet.livekit.io/custom"
          + "?liveKitUrl=" + encodeURIComponent(LIVEKIT_URL)
          + "&token="     + encodeURIComponent(LIVEKIT_TOKEN);

        frameEl.src = src;
        statusEl.textContent =
          "If the avatar does not appear, check browser permissions for camera/mic and reload.";
      }

      refreshEl.addEventListener("click", () => {
        frameEl.src = "";
        setTimeout(connect, 50);
      });

      // Initial auto-connect
      connect();
    </script>
  </body>
</html>
